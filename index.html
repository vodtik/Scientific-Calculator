<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Scientific Calculator</title>
    <style>
        :root {
            --primary-blue: #2196F3;
            --dark-blue: #1976D2;
            --light-blue: #E3F2FD;
            --white: #FFFFFF;
            --light-gray: #F5F5F5;
            --dark-gray: #424242;
            --shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            --transition: all 0.2s ease;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background-color: var(--light-gray);
            color: var(--dark-gray);
            display: flex;
            flex-direction: column;
            min-height: 100vh;
            transition: var(--transition);
        }

        body.dark-mode {
            background-color: #121212;
            color: var(--white);
        }

        .container {
            max-width: 1000px;
            margin: 0 auto;
            padding: 20px;
            width: 100%;
        }

        header {
            text-align: center;
            padding: 20px 0;
            background-color: var(--white);
            box-shadow: var(--shadow);
            margin-bottom: 30px;
        }

        body.dark-mode header {
            background-color: #1e1e1e;
        }

        h1 {
            color: var(--primary-blue);
            margin-bottom: 10px;
        }

        .theme-toggle {
            position: absolute;
            top: 20px;
            right: 20px;
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: var(--primary-blue);
        }

        .calculator-container {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            justify-content: center;
        }

        .calculator {
            background-color: var(--white);
            border-radius: 12px;
            box-shadow: var(--shadow);
            padding: 20px;
            width: 100%;
            max-width: 400px;
        }

        body.dark-mode .calculator {
            background-color: #1e1e1e;
        }

        .display {
            background-color: var(--light-blue);
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 20px;
            text-align: right;
            min-height: 100px;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
        }

        body.dark-mode .display {
            background-color: #2d2d2d;
        }

        .expression {
            font-size: 18px;
            color: var(--dark-gray);
            min-height: 27px;
            word-break: break-all;
        }

        body.dark-mode .expression {
            color: #b0b0b0;
        }

        .result {
            font-size: 32px;
            font-weight: bold;
            color: var(--primary-blue);
            word-break: break-all;
        }

        .buttons {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 10px;
        }

        button {
            padding: 15px 10px;
            border: none;
            border-radius: 8px;
            background-color: var(--light-blue);
            color: var(--dark-gray);
            font-size: 18px;
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            align-items: center;
            justify-content: center;
        }

        body.dark-mode button {
            background-color: #2d2d2d;
            color: var(--white);
        }

        button:hover {
            background-color: var(--primary-blue);
            color: var(--white);
            transform: translateY(-2px);
        }

        button:active {
            transform: translateY(0);
        }

        .operator {
            background-color: var(--primary-blue);
            color: var(--white);
        }

        body.dark-mode .operator {
            background-color: var(--dark-blue);
        }

        .equals {
            background-color: var(--dark-blue);
            color: var(--white);
            grid-column: span 2;
        }

        .scientific {
            background-color: #FF9800;
            color: var(--white);
        }

        .history {
            background-color: var(--white);
            border-radius: 12px;
            box-shadow: var(--shadow);
            padding: 20px;
            width: 100%;
            max-width: 400px;
            max-height: 500px;
            overflow-y: auto;
        }

        body.dark-mode .history {
            background-color: #1e1e1e;
        }

        .history h2 {
            color: var(--primary-blue);
            margin-bottom: 15px;
            text-align: center;
        }

        .history-list {
            list-style-type: none;
        }

        .history-item {
            padding: 10px;
            border-bottom: 1px solid var(--light-blue);
            cursor: pointer;
            transition: var(--transition);
        }

        body.dark-mode .history-item {
            border-bottom: 1px solid #2d2d2d;
        }

        .history-item:hover {
            background-color: var(--light-blue);
        }

        body.dark-mode .history-item:hover {
            background-color: #2d2d2d;
        }

        .history-expression {
            font-size: 14px;
            color: var(--dark-gray);
        }

        body.dark-mode .history-expression {
            color: #b0b0b0;
        }

        .history-result {
            font-size: 16px;
            font-weight: bold;
            color: var(--primary-blue);
        }

        .clear-history {
            display: block;
            margin: 15px auto 0;
            padding: 8px 15px;
            background-color: #f44336;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }

        .mode-toggle {
            display: flex;
            justify-content: center;
            margin-bottom: 15px;
            background-color: var(--light-blue);
            border-radius: 8px;
            padding: 5px;
        }

        body.dark-mode .mode-toggle {
            background-color: #2d2d2d;
        }

        .mode-btn {
            flex: 1;
            padding: 8px;
            text-align: center;
            background: transparent;
            border: none;
            border-radius: 5px;
            font-size: 14px;
        }

        .mode-btn.active {
            background-color: var(--primary-blue);
            color: white;
        }

        .error {
            color: #f44336;
            font-size: 14px;
            margin-top: 5px;
        }

        @media (max-width: 768px) {
            .calculator-container {
                flex-direction: column;
                align-items: center;
            }
            
            .calculator, .history {
                max-width: 100%;
            }
            
            .buttons {
                grid-template-columns: repeat(4, 1fr);
            }
            
            .scientific-buttons {
                grid-template-columns: repeat(3, 1fr);
            }
        }

        @media (max-width: 480px) {
            button {
                padding: 12px 5px;
                font-size: 16px;
            }
            
            .result {
                font-size: 28px;
            }
        }
    </style>
</head>
<body>
    <header>
        <div class="container">
            <h1>Scientific Calculator</h1>
            <p>Perform basic and scientific calculations with ease</p>
        </div>
    </header>

    <button class="theme-toggle" id="themeToggle">🌙</button>

    <div class="container">
        <div class="calculator-container">
            <div class="calculator">
                <div class="display">
                    <div class="expression" id="expression"></div>
                    <div class="result" id="result">0</div>
                </div>
                
                <div class="mode-toggle">
                    <button class="mode-btn active" id="degBtn">DEG</button>
                    <button class="mode-btn" id="radBtn">RAD</button>
                </div>
                
                <div class="buttons">
                    <!-- Scientific functions row 1 -->
                    <button class="scientific" data-action="sqrt">√</button>
                    <button class="scientific" data-action="square">x²</button>
                    <button class="scientific" data-action="power">x^y</button>
                    <button class="scientific" data-action="sin">sin</button>
                    <button class="scientific" data-action="cos">cos</button>
                    
                    <!-- Scientific functions row 2 -->
                    <button class="scientific" data-action="tan">tan</button>
                    <button class="scientific" data-action="log">log</button>
                    <button class="scientific" data-action="ln">ln</button>
                    <button class="scientific" data-action="factorial">x!</button>
                    <button class="scientific" data-action="percentage">%</button>
                    
                    <!-- First row -->
                    <button data-action="clear">C</button>
                    <button data-action="backspace">⌫</button>
                    <button class="operator" data-action="divide">/</button>
                    <button class="operator" data-action="multiply">×</button>
                    <button class="operator" data-action="openParenthesis">(</button>
                    
                    <!-- Second row -->
                    <button data-number="7">7</button>
                    <button data-number="8">8</button>
                    <button data-number="9">9</button>
                    <button class="operator" data-action="subtract">-</button>
                    <button class="operator" data-action="closeParenthesis">)</button>
                    
                    <!-- Third row -->
                    <button data-number="4">4</button>
                    <button data-number="5">5</button>
                    <button data-number="6">6</button>
                    <button class="operator" data-action="add">+</button>
                    <button data-action="pi">π</button>
                    
                    <!-- Fourth row -->
                    <button data-number="1">1</button>
                    <button data-number="2">2</button>
                    <button data-number="3">3</button>
                    <button data-action="decimal">.</button>
                    <button data-action="e">e</button>
                    
                    <!-- Fifth row -->
                    <button data-number="0">0</button>
                    <button data-action="toggleSign">±</button>
                    <button class="equals" data-action="calculate">=</button>
                </div>
                
                <div id="error" class="error"></div>
            </div>
            
            <div class="history">
                <h2>Calculation History</h2>
                <ul class="history-list" id="historyList">
                    <!-- History items will be added here dynamically -->
                </ul>
                <button class="clear-history" id="clearHistory">Clear History</button>
            </div>
        </div>
    </div>

    <script>
        // DOM Elements
        const expressionEl = document.getElementById('expression');
        const resultEl = document.getElementById('result');
        const errorEl = document.getElementById('error');
        const historyList = document.getElementById('historyList');
        const clearHistoryBtn = document.getElementById('clearHistory');
        const themeToggle = document.getElementById('themeToggle');
        const degBtn = document.getElementById('degBtn');
        const radBtn = document.getElementById('radBtn');

        // Calculator state
        let currentExpression = '';
        let currentResult = '0';
        let isRadians = false;
        let calculationHistory = [];

        // Theme toggle
        themeToggle.addEventListener('click', () => {
            document.body.classList.toggle('dark-mode');
            themeToggle.textContent = document.body.classList.contains('dark-mode') ? '☀️' : '🌙';
        });

        // Angle mode toggle
        degBtn.addEventListener('click', () => {
            isRadians = false;
            degBtn.classList.add('active');
            radBtn.classList.remove('active');
        });

        radBtn.addEventListener('click', () => {
            isRadians = true;
            radBtn.classList.add('active');
            degBtn.classList.remove('active');
        });

        // Button click handler
        document.querySelectorAll('button').forEach(button => {
            button.addEventListener('click', () => {
                const number = button.getAttribute('data-number');
                const action = button.getAttribute('data-action');
                
                if (number !== null) {
                    appendNumber(number);
                } else if (action !== null) {
                    handleAction(action);
                }
                
                updateDisplay();
            });
        });

        // Keyboard support
        document.addEventListener('keydown', event => {
            if (event.key >= '0' && event.key <= '9') {
                appendNumber(event.key);
            } else if (event.key === '.') {
                appendDecimal();
            } else if (event.key === '+' || event.key === '-' || event.key === '*' || event.key === '/') {
                handleAction(
                    event.key === '+' ? 'add' :
                    event.key === '-' ? 'subtract' :
                    event.key === '*' ? 'multiply' : 'divide'
                );
            } else if (event.key === 'Enter' || event.key === '=') {
                handleAction('calculate');
            } else if (event.key === 'Escape') {
                handleAction('clear');
            } else if (event.key === 'Backspace') {
                handleAction('backspace');
            } else if (event.key === '(') {
                handleAction('openParenthesis');
            } else if (event.key === ')') {
                handleAction('closeParenthesis');
            }
            
            updateDisplay();
        });

        // Number input
        function appendNumber(number) {
            if (currentResult !== '0' && currentExpression === '') {
                currentExpression = currentResult;
                currentResult = '0';
            }
            
            if (currentResult === '0') {
                currentResult = number;
            } else {
                currentResult += number;
            }
            
            clearError();
        }

        // Decimal point
        function appendDecimal() {
            if (!currentResult.includes('.')) {
                currentResult += currentResult === '' ? '0.' : '.';
            }
        }

        // Handle actions
        function handleAction(action) {
            clearError();
            
            switch (action) {
                case 'clear':
                    currentExpression = '';
                    currentResult = '0';
                    break;
                    
                case 'backspace':
                    if (currentResult.length > 1) {
                        currentResult = currentResult.slice(0, -1);
                    } else {
                        currentResult = '0';
                    }
                    break;
                    
                case 'add':
                case 'subtract':
                case 'multiply':
                case 'divide':
                    if (currentExpression === '' && currentResult !== '0') {
                        currentExpression = currentResult + 
                            (action === 'add' ? ' + ' :
                             action === 'subtract' ? ' - ' :
                             action === 'multiply' ? ' × ' : ' ÷ ');
                        currentResult = '0';
                    } else if (currentExpression !== '') {
                        // If we already have an expression, calculate it first
                        try {
                            const result = evaluateExpression(currentExpression + currentResult);
                            currentExpression = result + 
                                (action === 'add' ? ' + ' :
                                 action === 'subtract' ? ' - ' :
                                 action === 'multiply' ? ' × ' : ' ÷ ');
                            currentResult = '0';
                        } catch (error) {
                            showError(error.message);
                        }
                    }
                    break;
                    
                case 'square':
                    try {
                        const num = parseFloat(currentResult);
                        currentResult = (num * num).toString();
                        addToHistory(`sqr(${num})`, currentResult);
                    } catch (error) {
                        showError('Invalid input for square');
                    }
                    break;
                    
                case 'sqrt':
                    try {
                        const num = parseFloat(currentResult);
                        if (num < 0) throw new Error('Cannot calculate square root of negative number');
                        currentResult = Math.sqrt(num).toString();
                        addToHistory(`√(${num})`, currentResult);
                    } catch (error) {
                        showError(error.message);
                    }
                    break;
                    
                case 'power':
                    if (currentExpression === '') {
                        currentExpression = currentResult + '^';
                        currentResult = '0';
                    }
                    break;
                    
                case 'sin':
                    try {
                        const num = parseFloat(currentResult);
                        const angle = isRadians ? num : num * Math.PI / 180;
                        currentResult = Math.sin(angle).toString();
                        addToHistory(`sin(${num}${isRadians ? 'rad' : '°'})`, currentResult);
                    } catch (error) {
                        showError('Invalid input for sine');
                    }
                    break;
                    
                case 'cos':
                    try {
                        const num = parseFloat(currentResult);
                        const angle = isRadians ? num : num * Math.PI / 180;
                        currentResult = Math.cos(angle).toString();
                        addToHistory(`cos(${num}${isRadians ? 'rad' : '°'})`, currentResult);
                    } catch (error) {
                        showError('Invalid input for cosine');
                    }
                    break;
                    
                case 'tan':
                    try {
                        const num = parseFloat(currentResult);
                        const angle = isRadians ? num : num * Math.PI / 180;
                        if (Math.cos(angle) === 0) throw new Error('Tangent undefined for this angle');
                        currentResult = Math.tan(angle).toString();
                        addToHistory(`tan(${num}${isRadians ? 'rad' : '°'})`, currentResult);
                    } catch (error) {
                        showError(error.message);
                    }
                    break;
                    
                case 'log':
                    try {
                        const num = parseFloat(currentResult);
                        if (num <= 0) throw new Error('Logarithm undefined for non-positive numbers');
                        currentResult = Math.log10(num).toString();
                        addToHistory(`log(${num})`, currentResult);
                    } catch (error) {
                        showError(error.message);
                    }
                    break;
                    
                case 'ln':
                    try {
                        const num = parseFloat(currentResult);
                        if (num <= 0) throw new Error('Natural log undefined for non-positive numbers');
                        currentResult = Math.log(num).toString();
                        addToHistory(`ln(${num})`, currentResult);
                    } catch (error) {
                        showError(error.message);
                    }
                    break;
                    
                case 'factorial':
                    try {
                        const num = parseInt(currentResult);
                        if (num < 0 || !Number.isInteger(num)) throw new Error('Factorial defined only for non-negative integers');
                        if (num > 170) throw new Error('Number too large for factorial calculation');
                        
                        let result = 1;
                        for (let i = 2; i <= num; i++) {
                            result *= i;
                        }
                        currentResult = result.toString();
                        addToHistory(`${num}!`, currentResult);
                    } catch (error) {
                        showError(error.message);
                    }
                    break;
                    
                case 'percentage':
                    try {
                        const num = parseFloat(currentResult);
                        currentResult = (num / 100).toString();
                    } catch (error) {
                        showError('Invalid input for percentage');
                    }
                    break;
                    
                case 'openParenthesis':
                    if (currentExpression === '' && currentResult === '0') {
                        currentExpression = '(';
                        currentResult = '';
                    } else if (currentExpression !== '' && currentResult === '0') {
                        currentExpression += ' (';
                        currentResult = '';
                    } else {
                        currentExpression += currentResult + ' × (';
                        currentResult = '';
                    }
                    break;
                    
                case 'closeParenthesis':
                    if (currentExpression.includes('(') && !currentExpression.includes(')')) {
                        currentExpression += currentResult + ')';
                        currentResult = '0';
                    }
                    break;
                    
                case 'pi':
                    currentResult = Math.PI.toString();
                    break;
                    
                case 'e':
                    currentResult = Math.E.toString();
                    break;
                    
                case 'toggleSign':
                    if (currentResult !== '0') {
                        if (currentResult.startsWith('-')) {
                            currentResult = currentResult.substring(1);
                        } else {
                            currentResult = '-' + currentResult;
                        }
                    }
                    break;
                    
                case 'calculate':
                    try {
                        if (currentExpression !== '') {
                            const expression = currentExpression + currentResult;
                            const result = evaluateExpression(expression);
                            addToHistory(expression, result);
                            currentExpression = '';
                            currentResult = result.toString();
                        }
                    } catch (error) {
                        showError(error.message);
                    }
                    break;
            }
        }

        // Evaluate mathematical expression
        function evaluateExpression(expression) {
            // Replace × and ÷ with * and /
            expression = expression.replace(/×/g, '*').replace(/÷/g, '/');
            
            // Handle exponentiation (^)
            expression = expression.replace(/(\d+(?:\.\d+)?)\^(\d+(?:\.\d+)?)/g, 'Math.pow($1, $2)');
            
            // Evaluate the expression safely
            try {
                // Using Function constructor as a safer alternative to eval
                const result = new Function('return ' + expression)();
                
                if (!isFinite(result)) {
                    throw new Error('Result is not a finite number');
                }
                
                return result;
            } catch (error) {
                throw new Error('Invalid expression');
            }
        }

        // Update display
        function updateDisplay() {
            expressionEl.textContent = currentExpression;
            resultEl.textContent = currentResult;
        }

        // Show error message
        function showError(message) {
            errorEl.textContent = message;
        }

        // Clear error message
        function clearError() {
            errorEl.textContent = '';
        }

        // Add calculation to history
        function addToHistory(expression, result) {
            calculationHistory.unshift({ expression, result });
            
            // Keep only last 10 calculations
            if (calculationHistory.length > 10) {
                calculationHistory.pop();
            }
            
            updateHistoryDisplay();
        }

        // Update history display
        function updateHistoryDisplay() {
            historyList.innerHTML = '';
            
            calculationHistory.forEach(item => {
                const li = document.createElement('li');
                li.className = 'history-item';
                li.innerHTML = `
                    <div class="history-expression">${item.expression}</div>
                    <div class="history-result">= ${item.result}</div>
                `;
                
                li.addEventListener('click', () => {
                    currentExpression = '';
                    currentResult = item.result;
                    updateDisplay();
                });
                
                historyList.appendChild(li);
            });
        }

        // Clear history
        clearHistoryBtn.addEventListener('click', () => {
            calculationHistory = [];
            updateHistoryDisplay();
        });

        // Initialize
        updateDisplay();
    </script>
</body>
</html>
